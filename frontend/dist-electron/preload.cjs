"use strict";const j=require("electron"),M=require("os"),Dt=require("child_process"),Zr=require("fs"),es=require("url"),ts=require("http"),rs=require("https"),it=require("tty"),Kt=require("util"),Fe=require("stream"),Ds=require("zlib"),Ps=require("path"),Is=require("buffer"),Qt=require("crypto"),$s=require("events"),qs=require("net"),Us=require("tls");function Ms(s,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in s)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(s,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}function Ne(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */var de=Zr,cr=es,js=Dt.spawn,ss=Pt;Pt.XMLHttpRequest=Pt;function Pt(s){s=s||{};var e=this,t=ts,r=rs,n,i,l={},h=!1,c={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},u=Object.assign({},c),d=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],a=["TRACE","TRACK","CONNECT"],o=!1,f=!1,g=!1,p={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),this.status=null,this.statusText=null;var y=function(m){return h||m&&d.indexOf(m.toLowerCase())===-1},_=function(m){return m&&a.indexOf(m)===-1};this.open=function(m,C,x,L,R){if(this.abort(),f=!1,g=!1,!_(m))throw new Error("SecurityError: Request method not allowed");l={method:m,url:C.toString(),async:typeof x!="boolean"?!0:x,user:L||null,password:R||null},E(this.OPENED)},this.setDisableHeaderCheck=function(m){h=m},this.setRequestHeader=function(m,C){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!y(m))return console.warn('Refused to set unsafe header "'+m+'"'),!1;if(o)throw new Error("INVALID_STATE_ERR: send flag is true");return u[m]=C,!0},this.getResponseHeader=function(m){return typeof m=="string"&&this.readyState>this.OPENED&&i.headers[m.toLowerCase()]&&!f?i.headers[m.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||f)return"";var m="";for(var C in i.headers)C!=="set-cookie"&&C!=="set-cookie2"&&(m+=C+": "+i.headers[C]+`\r
`);return m.substr(0,m.length-2)},this.getRequestHeader=function(m){return typeof m=="string"&&u[m]?u[m]:""},this.send=function(m){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(o)throw new Error("INVALID_STATE_ERR: send has already been called");var C=!1,x=!1,L=cr.parse(l.url),R;switch(L.protocol){case"https:":C=!0;case"http:":R=L.hostname;break;case"file:":x=!0;break;case void 0:case"":R="localhost";break;default:throw new Error("Protocol not supported.")}if(x){if(l.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(l.async)de.readFile(unescape(L.pathname),function(D,ee){D?e.handleError(D,D.errno||-1):(e.status=200,e.responseText=ee.toString("utf8"),e.response=ee,E(e.DONE))});else try{this.response=de.readFileSync(unescape(L.pathname)),this.responseText=this.response.toString("utf8"),this.status=200,E(e.DONE)}catch(D){this.handleError(D,D.errno||-1)}return}var q=L.port||(C?443:80),I=L.pathname+(L.search?L.search:"");if(u.Host=R,C&&q===443||q===80||(u.Host+=":"+L.port),l.user){typeof l.password>"u"&&(l.password="");var G=new Buffer(l.user+":"+l.password);u.Authorization="Basic "+G.toString("base64")}if(l.method==="GET"||l.method==="HEAD")m=null;else if(m){u["Content-Length"]=Buffer.isBuffer(m)?m.length:Buffer.byteLength(m);var S=Object.keys(u);S.some(function(D){return D.toLowerCase()==="content-type"})||(u["Content-Type"]="text/plain;charset=UTF-8")}else l.method==="POST"&&(u["Content-Length"]=0);var O=s.agent||!1,v={host:R,port:q,path:I,method:l.method,headers:u,agent:O};if(C&&(v.pfx=s.pfx,v.key=s.key,v.passphrase=s.passphrase,v.cert=s.cert,v.ca=s.ca,v.ciphers=s.ciphers,v.rejectUnauthorized=s.rejectUnauthorized!==!1),f=!1,l.async){var A=C?r.request:t.request;o=!0,e.dispatchEvent("readystatechange");var X=function(D){if(i=D,i.statusCode===302||i.statusCode===303||i.statusCode===307){l.url=i.headers.location;var ee=cr.parse(l.url);R=ee.hostname;var W={hostname:ee.hostname,port:ee.port,path:ee.path,method:i.statusCode===303?"GET":l.method,headers:u};C&&(W.pfx=s.pfx,W.key=s.key,W.passphrase=s.passphrase,W.cert=s.cert,W.ca=s.ca,W.ciphers=s.ciphers,W.rejectUnauthorized=s.rejectUnauthorized!==!1),n=A(W,X).on("error",F),n.end();return}E(e.HEADERS_RECEIVED),e.status=i.statusCode,i.on("data",function(Ae){if(Ae){var Bs=Buffer.from(Ae);e.response=Buffer.concat([e.response,Bs])}o&&E(e.LOADING)}),i.on("end",function(){o&&(o=!1,E(e.DONE),e.responseText=e.response.toString("utf8"))}),i.on("error",function(Ae){e.handleError(Ae)})},F=function(D){if(n.reusedSocket&&D.code==="ECONNRESET")return A(v,X).on("error",F);e.handleError(D)};n=A(v,X).on("error",F),s.autoUnref&&n.on("socket",D=>{D.unref()}),m&&n.write(m),n.end(),e.dispatchEvent("loadstart")}else{var ae=".node-xmlhttprequest-content-"+process.pid,se=".node-xmlhttprequest-sync-"+process.pid;de.writeFileSync(se,"","utf8");for(var Ee="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(C?"s":"")+".request;var options = "+JSON.stringify(v)+";var responseText = '';var responseData = Buffer.alloc(0);var req = doRequest(options, function(response) {response.on('data', function(chunk) {  var data = Buffer.from(chunk);  responseText += data.toString('utf8');  responseData = Buffer.concat([responseData, data]);});response.on('end', function() {fs.writeFileSync('"+ae+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText, data: responseData.toString('base64')}}), 'utf8');fs.unlinkSync('"+se+"');});response.on('error', function(error) {fs.writeFileSync('"+ae+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+se+"');});}).on('error', function(error) {fs.writeFileSync('"+ae+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+se+"');});"+(m?"req.write('"+JSON.stringify(m).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",pt=js(process.argv[0],["-e",Ee]);de.existsSync(se););if(e.responseText=de.readFileSync(ae,"utf8"),pt.stdin.end(),de.unlinkSync(ae),e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var Le=JSON.parse(e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,""));e.handleError(Le,503)}else{e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1");var he=JSON.parse(e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"));i={statusCode:e.status,headers:he.data.headers},e.responseText=he.data.text,e.response=Buffer.from(he.data.data,"base64"),E(e.DONE)}}},this.handleError=function(m,C){this.status=C||0,this.statusText=m,this.responseText=m.stack,f=!0,E(this.DONE)},this.abort=function(){n&&(n.abort(),n=null),u=Object.assign({},c),this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),f=g=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||o)&&this.readyState!==this.DONE&&(o=!1,E(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(m,C){m in p||(p[m]=[]),p[m].push(C)},this.removeEventListener=function(m,C){m in p&&(p[m]=p[m].filter(function(x){return x!==C}))},this.dispatchEvent=function(m){if(typeof e["on"+m]=="function"&&(this.readyState===this.DONE&&l.async?setTimeout(function(){e["on"+m]()},0):e["on"+m]()),m in p)for(let C=0,x=p[m].length;C<x;C++)this.readyState===this.DONE?setTimeout(function(){p[m][C].call(e)},0):p[m][C].call(e)};var E=function(m){if(!(e.readyState===m||e.readyState===e.UNSENT&&g)&&(e.readyState=m,(l.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE)){let C;g?C="abort":f?C="error":C="load",e.dispatchEvent(C),e.dispatchEvent("loadend")}}}const ns=Ne(ss),Vs=Ms({__proto__:null,default:ns},[ss]),Z=Object.create(null);Z.open="0";Z.close="1";Z.ping="2";Z.pong="3";Z.message="4";Z.upgrade="5";Z.noop="6";const Je=Object.create(null);Object.keys(Z).forEach(s=>{Je[Z[s]]=s});const It={type:"error",data:"parser error"},Zt=({type:s,data:e},t,r)=>e instanceof ArrayBuffer||ArrayBuffer.isView(e)?r(t?e:"b"+is(e,!0).toString("base64")):r(Z[s]+(e||"")),is=(s,e)=>Buffer.isBuffer(s)||s instanceof Uint8Array&&!e?s:s instanceof ArrayBuffer?Buffer.from(s):Buffer.from(s.buffer,s.byteOffset,s.byteLength);let mt;function Gs(s,e){if(s.data instanceof ArrayBuffer||ArrayBuffer.isView(s.data))return e(is(s.data,!1));Zt(s,!0,t=>{mt||(mt=new TextEncoder),e(mt.encode(t))})}const er=(s,e)=>{if(typeof s!="string")return{type:"message",data:lr(s,e)};const t=s.charAt(0);if(t==="b"){const r=Buffer.from(s.substring(1),"base64");return{type:"message",data:lr(r,e)}}return Je[t]?s.length>1?{type:Je[t],data:s.substring(1)}:{type:Je[t]}:It},lr=(s,e)=>{switch(e){case"arraybuffer":return s instanceof ArrayBuffer?s:Buffer.isBuffer(s)?s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength):s.buffer;case"nodebuffer":default:return Buffer.isBuffer(s)?s:Buffer.from(s)}},os="",Ws=(s,e)=>{const t=s.length,r=new Array(t);let n=0;s.forEach((i,l)=>{Zt(i,!1,h=>{r[l]=h,++n===t&&e(r.join(os))})})},Hs=(s,e)=>{const t=s.split(os),r=[];for(let n=0;n<t.length;n++){const i=er(t[n],e);if(r.push(i),i.type==="error")break}return r};function zs(){return new TransformStream({transform(s,e){Gs(s,t=>{const r=t.length;let n;if(r<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,r);else if(r<65536){n=new Uint8Array(3);const i=new DataView(n.buffer);i.setUint8(0,126),i.setUint16(1,r)}else{n=new Uint8Array(9);const i=new DataView(n.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(r))}s.data&&typeof s.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(t)})}})}let gt;function Be(s){return s.reduce((e,t)=>e+t.length,0)}function De(s,e){if(s[0].length===e)return s.shift();const t=new Uint8Array(e);let r=0;for(let n=0;n<e;n++)t[n]=s[0][r++],r===s[0].length&&(s.shift(),r=0);return s.length&&r<s[0].length&&(s[0]=s[0].slice(r)),t}function Ys(s,e){gt||(gt=new TextDecoder);const t=[];let r=0,n=-1,i=!1;return new TransformStream({transform(l,h){for(t.push(l);;){if(r===0){if(Be(t)<1)break;const c=De(t,1);i=(c[0]&128)===128,n=c[0]&127,n<126?r=3:n===126?r=1:r=2}else if(r===1){if(Be(t)<2)break;const c=De(t,2);n=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(r===2){if(Be(t)<8)break;const c=De(t,8),u=new DataView(c.buffer,c.byteOffset,c.length),d=u.getUint32(0);if(d>Math.pow(2,21)-1){h.enqueue(It);break}n=d*Math.pow(2,32)+u.getUint32(4),r=3}else{if(Be(t)<n)break;const c=De(t,n);h.enqueue(er(i?c:gt.decode(c),e)),r=0}if(n===0||n>s){h.enqueue(It);break}}}})}const as=4;function N(s){if(s)return Xs(s)}function Xs(s){for(var e in N.prototype)s[e]=N.prototype[e];return s}N.prototype.on=N.prototype.addEventListener=function(s,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(e),this};N.prototype.once=function(s,e){function t(){this.off(s,t),e.apply(this,arguments)}return t.fn=e,this.on(s,t),this};N.prototype.off=N.prototype.removeListener=N.prototype.removeAllListeners=N.prototype.removeEventListener=function(s,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+s];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var r,n=0;n<t.length;n++)if(r=t[n],r===e||r.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+s],this};N.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+s],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,n=t.length;r<n;++r)t[r].apply(this,e)}return this};N.prototype.emitReserved=N.prototype.emit;N.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};N.prototype.hasListeners=function(s){return!!this.listeners(s).length};const ot=process.nextTick,K=global,Js="nodebuffer";function Ks(){return new Zs}function Qs(s){const e=s.split("; "),t=e[0].indexOf("=");if(t===-1)return;const r=e[0].substring(0,t).trim();if(!r.length)return;let n=e[0].substring(t+1).trim();n.charCodeAt(0)===34&&(n=n.slice(1,-1));const i={name:r,value:n};for(let l=1;l<e.length;l++){const h=e[l].split("=");if(h.length!==2)continue;const c=h[0].trim(),u=h[1].trim();switch(c){case"Expires":i.expires=new Date(u);break;case"Max-Age":const d=new Date;d.setUTCSeconds(d.getUTCSeconds()+parseInt(u,10)),i.expires=d;break}}return i}class Zs{constructor(){this._cookies=new Map}parseCookies(e){e&&e.forEach(t=>{const r=Qs(t);r&&this._cookies.set(r.name,r)})}get cookies(){const e=Date.now();return this._cookies.forEach((t,r)=>{var n;((n=t.expires)===null||n===void 0?void 0:n.getTime())<e&&this._cookies.delete(r)}),this._cookies.entries()}addCookies(e){const t=[];for(const[r,n]of this.cookies)t.push(`${r}=${n.value}`);t.length&&(e.setDisableHeaderCheck(!0),e.setRequestHeader("cookie",t.join("; ")))}appendCookies(e){for(const[t,r]of this.cookies)e.append("cookie",`${t}=${r.value}`)}}function cs(s,...e){return e.reduce((t,r)=>(s.hasOwnProperty(r)&&(t[r]=s[r]),t),{})}const en=K.setTimeout,tn=K.clearTimeout;function at(s,e){e.useNativeTimers?(s.setTimeoutFn=en.bind(K),s.clearTimeoutFn=tn.bind(K)):(s.setTimeoutFn=K.setTimeout.bind(K),s.clearTimeoutFn=K.clearTimeout.bind(K))}const rn=1.33;function sn(s){return typeof s=="string"?nn(s):Math.ceil((s.byteLength||s.size)*rn)}function nn(s){let e=0,t=0;for(let r=0,n=s.length;r<n;r++)e=s.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function ls(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function on(s){let e="";for(let t in s)s.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(s[t]));return e}function an(s){let e={},t=s.split("&");for(let r=0,n=t.length;r<n;r++){let i=t[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}var $t={exports:{}},Pe={exports:{}},_t,fr;function tr(){if(fr)return _t;fr=1;var s=1e3,e=s*60,t=e*60,r=t*24,n=r*7,i=r*365.25;_t=function(d,a){a=a||{};var o=typeof d;if(o==="string"&&d.length>0)return l(d);if(o==="number"&&isFinite(d))return a.long?c(d):h(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function l(d){if(d=String(d),!(d.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(a){var o=parseFloat(a[1]),f=(a[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return o*i;case"weeks":case"week":case"w":return o*n;case"days":case"day":case"d":return o*r;case"hours":case"hour":case"hrs":case"hr":case"h":return o*t;case"minutes":case"minute":case"mins":case"min":case"m":return o*e;case"seconds":case"second":case"secs":case"sec":case"s":return o*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}function h(d){var a=Math.abs(d);return a>=r?Math.round(d/r)+"d":a>=t?Math.round(d/t)+"h":a>=e?Math.round(d/e)+"m":a>=s?Math.round(d/s)+"s":d+"ms"}function c(d){var a=Math.abs(d);return a>=r?u(d,a,r,"day"):a>=t?u(d,a,t,"hour"):a>=e?u(d,a,e,"minute"):a>=s?u(d,a,s,"second"):d+" ms"}function u(d,a,o,f){var g=a>=o*1.5;return Math.round(d/o)+" "+f+(g?"s":"")}return _t}var yt,ur;function fs(){if(ur)return yt;ur=1;function s(e){r.debug=r,r.default=r,r.coerce=u,r.disable=l,r.enable=i,r.enabled=h,r.humanize=tr(),r.destroy=d,Object.keys(e).forEach(a=>{r[a]=e[a]}),r.names=[],r.skips=[],r.formatters={};function t(a){let o=0;for(let f=0;f<a.length;f++)o=(o<<5)-o+a.charCodeAt(f),o|=0;return r.colors[Math.abs(o)%r.colors.length]}r.selectColor=t;function r(a){let o,f=null,g,p;function y(..._){if(!y.enabled)return;const E=y,m=Number(new Date),C=m-(o||m);E.diff=C,E.prev=o,E.curr=m,o=m,_[0]=r.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let x=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(R,q)=>{if(R==="%%")return"%";x++;const I=r.formatters[q];if(typeof I=="function"){const G=_[x];R=I.call(E,G),_.splice(x,1),x--}return R}),r.formatArgs.call(E,_),(E.log||r.log).apply(E,_)}return y.namespace=a,y.useColors=r.useColors(),y.color=r.selectColor(a),y.extend=n,y.destroy=r.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(g!==r.namespaces&&(g=r.namespaces,p=r.enabled(a)),p),set:_=>{f=_}}),typeof r.init=="function"&&r.init(y),y}function n(a,o){const f=r(this.namespace+(typeof o>"u"?":":o)+a);return f.log=this.log,f}function i(a){r.save(a),r.namespaces=a,r.names=[],r.skips=[];let o;const f=(typeof a=="string"?a:"").split(/[\s,]+/),g=f.length;for(o=0;o<g;o++)f[o]&&(a=f[o].replace(/\*/g,".*?"),a[0]==="-"?r.skips.push(new RegExp("^"+a.slice(1)+"$")):r.names.push(new RegExp("^"+a+"$")))}function l(){const a=[...r.names.map(c),...r.skips.map(c).map(o=>"-"+o)].join(",");return r.enable(""),a}function h(a){if(a[a.length-1]==="*")return!0;let o,f;for(o=0,f=r.skips.length;o<f;o++)if(r.skips[o].test(a))return!1;for(o=0,f=r.names.length;o<f;o++)if(r.names[o].test(a))return!0;return!1}function c(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function u(a){return a instanceof Error?a.stack||a.message:a}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return yt=s,yt}var hr;function cn(){return hr||(hr=1,function(s,e){e.formatArgs=r,e.save=n,e.load=i,e.useColors=t,e.storage=l(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let d=0,a=0;c[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(d++,o==="%c"&&(a=d))}),c.splice(a,0,u)}e.log=console.debug||console.log||(()=>{});function n(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function i(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function l(){try{return localStorage}catch{}}s.exports=fs()(e);const{formatters:h}=s.exports;h.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}(Pe,Pe.exports)),Pe.exports}var Ie={exports:{}},Ct,dr;function ln(){return dr||(dr=1,Ct=(s,e=process.argv)=>{const t=s.startsWith("-")?"":s.length===1?"-":"--",r=e.indexOf(t+s),n=e.indexOf("--");return r!==-1&&(n===-1||r<n)}),Ct}var vt,pr;function rr(){if(pr)return vt;pr=1;const s=M,e=it,t=ln(),{env:r}=process;let n;t("no-color")||t("no-colors")||t("color=false")||t("color=never")?n=0:(t("color")||t("colors")||t("color=true")||t("color=always"))&&(n=1),"FORCE_COLOR"in r&&(r.FORCE_COLOR==="true"?n=1:r.FORCE_COLOR==="false"?n=0:n=r.FORCE_COLOR.length===0?1:Math.min(parseInt(r.FORCE_COLOR,10),3));function i(c){return c===0?!1:{level:c,hasBasic:!0,has256:c>=2,has16m:c>=3}}function l(c,u){if(n===0)return 0;if(t("color=16m")||t("color=full")||t("color=truecolor"))return 3;if(t("color=256"))return 2;if(c&&!u&&n===void 0)return 0;const d=n||0;if(r.TERM==="dumb")return d;if(process.platform==="win32"){const a=s.release().split(".");return Number(a[0])>=10&&Number(a[2])>=10586?Number(a[2])>=14931?3:2:1}if("CI"in r)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(a=>a in r)||r.CI_NAME==="codeship"?1:d;if("TEAMCITY_VERSION"in r)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(r.TEAMCITY_VERSION)?1:0;if(r.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in r){const a=parseInt((r.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(r.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(r.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(r.TERM)||"COLORTERM"in r?1:d}function h(c){const u=l(c,c&&c.isTTY);return i(u)}return vt={supportsColor:h,stdout:i(l(!0,e.isatty(1))),stderr:i(l(!0,e.isatty(2)))},vt}var mr;function fn(){return mr||(mr=1,function(s,e){const t=it,r=Kt;e.init=d,e.log=h,e.formatArgs=i,e.save=c,e.load=u,e.useColors=n,e.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),e.colors=[6,2,3,4,5,1];try{const o=rr();o&&(o.stderr||o).level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}e.inspectOpts=Object.keys(process.env).filter(o=>/^debug_/i.test(o)).reduce((o,f)=>{const g=f.substring(6).toLowerCase().replace(/_([a-z])/g,(y,_)=>_.toUpperCase());let p=process.env[f];return/^(yes|on|true|enabled)$/i.test(p)?p=!0:/^(no|off|false|disabled)$/i.test(p)?p=!1:p==="null"?p=null:p=Number(p),o[g]=p,o},{});function n(){return"colors"in e.inspectOpts?!!e.inspectOpts.colors:t.isatty(process.stderr.fd)}function i(o){const{namespace:f,useColors:g}=this;if(g){const p=this.color,y="\x1B[3"+(p<8?p:"8;5;"+p),_=`  ${y};1m${f} \x1B[0m`;o[0]=_+o[0].split(`
`).join(`
`+_),o.push(y+"m+"+s.exports.humanize(this.diff)+"\x1B[0m")}else o[0]=l()+f+" "+o[0]}function l(){return e.inspectOpts.hideDate?"":new Date().toISOString()+" "}function h(...o){return process.stderr.write(r.formatWithOptions(e.inspectOpts,...o)+`
`)}function c(o){o?process.env.DEBUG=o:delete process.env.DEBUG}function u(){return process.env.DEBUG}function d(o){o.inspectOpts={};const f=Object.keys(e.inspectOpts);for(let g=0;g<f.length;g++)o.inspectOpts[f[g]]=e.inspectOpts[f[g]]}s.exports=fs()(e);const{formatters:a}=s.exports;a.o=function(o){return this.inspectOpts.colors=this.useColors,r.inspect(o,this.inspectOpts).split(`
`).map(f=>f.trim()).join(" ")},a.O=function(o){return this.inspectOpts.colors=this.useColors,r.inspect(o,this.inspectOpts)}}(Ie,Ie.exports)),Ie.exports}typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?$t.exports=cn():$t.exports=fn();var un=$t.exports;const ye=Ne(un),hn=ye("engine.io-client:transport");class dn extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class sr extends N{constructor(e){super(),this.writable=!1,at(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new dn(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"?this.write(e):hn("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=er(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=on(e);return t.length?"?"+t:""}}const H=ye("engine.io-client:polling");class pn extends sr{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{H("paused"),this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(H("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){H("pre-pause polling complete"),--r||t()})),this.writable||(H("we are currently writing - waiting to pause"),r++,this.once("drain",function(){H("pre-pause writing complete"),--r||t()}))}else t()}_poll(){H("polling"),this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){H("polling got data %s",e);const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Hs(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"?this._poll():H('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{H("writing close packet"),this.write([{type:"close"}])};this.readyState==="open"?(H("transport open - closing"),e()):(H("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,Ws(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=ls()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let us=!1;try{us=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const mn=us,qt=ye("engine.io-client:polling");function gn(){}class _n extends pn{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(n,i)=>{this.onError("xhr post error",n,i)})}doPoll(){qt("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Q extends N{constructor(e,t,r){super(),this.createRequest=e,at(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=cs(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{qt("xhr open %s: %s",this._method,this._uri),r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&r.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var n;r.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},qt("xhr data %s",this._data),r.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=Q.requestsCount++,Q.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=gn,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Q.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Q.requestsCount=0;Q.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",gr);else if(typeof addEventListener=="function"){const s="onpagehide"in K?"pagehide":"unload";addEventListener(s,gr,!1)}}function gr(){for(let s in Q.requests)Q.requests.hasOwnProperty(s)&&Q.requests[s].abort()}(function(){const s=yn({xdomain:!1});return s&&s.responseType!==null})();function yn(s){const e=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||mn))return new XMLHttpRequest}catch{}try{return new K[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Cn=ns||Vs;class vn extends _n{request(e={}){var t;return Object.assign(e,{xd:this.xd,cookieJar:(t=this.socket)===null||t===void 0?void 0:t._cookieJar},this.opts),new Q(r=>new Cn(r),this.uri(),e)}}const{Duplex:vo}=Fe;var rt={exports:{}},ue={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},$e={exports:{}};function hs(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qe={exports:{}},Et,_r;function En(){if(_r)return Et;_r=1;var s=Zr,e=Ps,t=M,r=typeof __webpack_require__=="function"?__non_webpack_require__:hs,n=process.config&&process.config.variables||{},i=!!process.env.PREBUILDS_ONLY,l=process.versions.modules,h=I()?"electron":q()?"node-webkit":"node",c=process.env.npm_config_arch||t.arch(),u=process.env.npm_config_platform||t.platform(),d=process.env.LIBC||(G(u)?"musl":"glibc"),a=process.env.ARM_VERSION||(c==="arm64"?"8":n.arm_version)||"",o=(process.versions.uv||"").split(".")[0];Et=f;function f(S){return r(f.resolve(S))}f.resolve=f.path=function(S){S=e.resolve(S||".");try{var O=r(e.join(S,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[O+"_PREBUILD"]&&(S=process.env[O+"_PREBUILD"])}catch{}if(!i){var v=p(e.join(S,"build/Release"),y);if(v)return v;var A=p(e.join(S,"build/Debug"),y);if(A)return A}var X=se(S);if(X)return X;var F=se(e.dirname(process.execPath));if(F)return F;var ae=["platform="+u,"arch="+c,"runtime="+h,"abi="+l,"uv="+o,a?"armv="+a:"","libc="+d,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+ae+`
    loaded from: `+S+`
`);function se(Ee){var pt=g(e.join(Ee,"prebuilds")).map(_),Le=pt.filter(E(u,c)).sort(m)[0];if(Le){var he=e.join(Ee,"prebuilds",Le.name),D=g(he).map(C),ee=D.filter(x(h,l)),W=ee.sort(R(h))[0];if(W)return e.join(he,W.file)}}};function g(S){try{return s.readdirSync(S)}catch{return[]}}function p(S,O){var v=g(S).filter(O);return v[0]&&e.join(S,v[0])}function y(S){return/\.node$/.test(S)}function _(S){var O=S.split("-");if(O.length===2){var v=O[0],A=O[1].split("+");if(v&&A.length&&A.every(Boolean))return{name:S,platform:v,architectures:A}}}function E(S,O){return function(v){return v==null||v.platform!==S?!1:v.architectures.includes(O)}}function m(S,O){return S.architectures.length-O.architectures.length}function C(S){var O=S.split("."),v=O.pop(),A={file:S,specificity:0};if(v==="node"){for(var X=0;X<O.length;X++){var F=O[X];if(F==="node"||F==="electron"||F==="node-webkit")A.runtime=F;else if(F==="napi")A.napi=!0;else if(F.slice(0,3)==="abi")A.abi=F.slice(3);else if(F.slice(0,2)==="uv")A.uv=F.slice(2);else if(F.slice(0,4)==="armv")A.armv=F.slice(4);else if(F==="glibc"||F==="musl")A.libc=F;else continue;A.specificity++}return A}}function x(S,O){return function(v){return!(v==null||v.runtime&&v.runtime!==S&&!L(v)||v.abi&&v.abi!==O&&!v.napi||v.uv&&v.uv!==o||v.armv&&v.armv!==a||v.libc&&v.libc!==d)}}function L(S){return S.runtime==="node"&&S.napi}function R(S){return function(O,v){return O.runtime!==v.runtime?O.runtime===S?-1:1:O.abi!==v.abi?O.abi?-1:1:O.specificity!==v.specificity?O.specificity>v.specificity?-1:1:0}}function q(){return!!(process.versions&&process.versions.nw)}function I(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function G(S){return S==="linux"&&s.existsSync("/etc/alpine-release")}return f.parseTags=C,f.matchTags=x,f.compareTags=R,f.parseTuple=_,f.matchTuple=E,f.compareTuples=m,Et}var yr;function ds(){if(yr)return qe.exports;yr=1;const s=typeof __webpack_require__=="function"?__non_webpack_require__:hs;return typeof s.addon=="function"?qe.exports=s.addon.bind(s):qe.exports=En(),qe.exports}var wt,Cr;function wn(){return Cr||(Cr=1,wt={mask:(t,r,n,i,l)=>{for(var h=0;h<l;h++)n[i+h]=t[h]^r[h&3]},unmask:(t,r)=>{const n=t.length;for(var i=0;i<n;i++)t[i]^=r[i&3]}}),wt}var vr;function bn(){if(vr)return $e.exports;vr=1;try{$e.exports=ds()(__dirname)}catch{$e.exports=wn()}return $e.exports}var Sn,kn;const{EMPTY_BUFFER:xn}=ue,Ut=Buffer[Symbol.species];function On(s,e){if(s.length===0)return xn;if(s.length===1)return s[0];const t=Buffer.allocUnsafe(e);let r=0;for(let n=0;n<s.length;n++){const i=s[n];t.set(i,r),r+=i.length}return r<e?new Ut(t.buffer,t.byteOffset,r):t}function ps(s,e,t,r,n){for(let i=0;i<n;i++)t[r+i]=s[i]^e[i&3]}function ms(s,e){for(let t=0;t<s.length;t++)s[t]^=e[t&3]}function Tn(s){return s.length===s.buffer.byteLength?s.buffer:s.buffer.slice(s.byteOffset,s.byteOffset+s.length)}function Mt(s){if(Mt.readOnly=!0,Buffer.isBuffer(s))return s;let e;return s instanceof ArrayBuffer?e=new Ut(s):ArrayBuffer.isView(s)?e=new Ut(s.buffer,s.byteOffset,s.byteLength):(e=Buffer.from(s),Mt.readOnly=!1),e}rt.exports={concat:On,mask:ps,toArrayBuffer:Tn,toBuffer:Mt,unmask:ms};if(!process.env.WS_NO_BUFFER_UTIL)try{const s=bn();kn=rt.exports.mask=function(e,t,r,n,i){i<48?ps(e,t,r,n,i):s.mask(e,t,r,n,i)},Sn=rt.exports.unmask=function(e,t){e.length<32?ms(e,t):s.unmask(e,t)}}catch{}var ct=rt.exports;const Er=Symbol("kDone"),bt=Symbol("kRun");let Rn=class{constructor(e){this[Er]=()=>{this.pending--,this[bt]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[bt]()}[bt](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[Er])}}};var Fn=Rn;const we=Ds,wr=ct,Nn=Fn,{kStatusCode:gs}=ue,Ln=Buffer[Symbol.species],An=Buffer.from([0,0,255,255]),st=Symbol("permessage-deflate"),te=Symbol("total-length"),Oe=Symbol("callback"),ne=Symbol("buffers"),Ke=Symbol("error");let Ue,Bn=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!Ue){const n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Ue=new Nn(n)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[Oe];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find(n=>!(t.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>n.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let n=t[r];if(n.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(n=n[0],r==="client_max_window_bits"){if(n!==!0){const i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else if(r==="server_max_window_bits"){const i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=n})}),e}decompress(e,t,r){Ue.add(n=>{this._decompress(e,t,(i,l)=>{n(),r(i,l)})})}compress(e,t,r){Ue.add(n=>{this._compress(e,t,(i,l)=>{n(),r(i,l)})})}_decompress(e,t,r){const n=this._isServer?"client":"server";if(!this._inflate){const i=`${n}_max_window_bits`,l=typeof this.params[i]!="number"?we.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=we.createInflateRaw({...this._options.zlibInflateOptions,windowBits:l}),this._inflate[st]=this,this._inflate[te]=0,this._inflate[ne]=[],this._inflate.on("error",Pn),this._inflate.on("data",_s)}this._inflate[Oe]=r,this._inflate.write(e),t&&this._inflate.write(An),this._inflate.flush(()=>{const i=this._inflate[Ke];if(i){this._inflate.close(),this._inflate=null,r(i);return}const l=wr.concat(this._inflate[ne],this._inflate[te]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[te]=0,this._inflate[ne]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,l)})}_compress(e,t,r){const n=this._isServer?"server":"client";if(!this._deflate){const i=`${n}_max_window_bits`,l=typeof this.params[i]!="number"?we.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=we.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:l}),this._deflate[te]=0,this._deflate[ne]=[],this._deflate.on("data",Dn)}this._deflate[Oe]=r,this._deflate.write(e),this._deflate.flush(we.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=wr.concat(this._deflate[ne],this._deflate[te]);t&&(i=new Ln(i.buffer,i.byteOffset,i.length-4)),this._deflate[Oe]=null,this._deflate[te]=0,this._deflate[ne]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,i)})}};var nr=Bn;function Dn(s){this[ne].push(s),this[te]+=s.length}function _s(s){if(this[te]+=s.length,this[st]._maxPayload<1||this[te]<=this[st]._maxPayload){this[ne].push(s);return}this[Ke]=new RangeError("Max payload size exceeded"),this[Ke].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Ke][gs]=1009,this.removeListener("data",_s),this.reset()}function Pn(s){this[st]._inflate=null,s[gs]=1007,this[Oe](s)}var nt={exports:{}},Me={exports:{}},St,br;function In(){if(br)return St;br=1;function s(e){const t=e.length;let r=0;for(;r<t;)if(!(e[r]&128))r++;else if((e[r]&224)===192){if(r+1===t||(e[r+1]&192)!==128||(e[r]&254)===192)return!1;r+=2}else if((e[r]&240)===224){if(r+2>=t||(e[r+1]&192)!==128||(e[r+2]&192)!==128||e[r]===224&&(e[r+1]&224)===128||e[r]===237&&(e[r+1]&224)===160)return!1;r+=3}else if((e[r]&248)===240){if(r+3>=t||(e[r+1]&192)!==128||(e[r+2]&192)!==128||(e[r+3]&192)!==128||e[r]===240&&(e[r+1]&240)===128||e[r]===244&&e[r+1]>143||e[r]>244)return!1;r+=4}else return!1;return!0}return St=s,St}var Sr;function $n(){if(Sr)return Me.exports;Sr=1;try{Me.exports=ds()(__dirname)}catch{Me.exports=In()}return Me.exports}var kr;const{isUtf8:xr}=Is,qn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Un(s){return s>=1e3&&s<=1014&&s!==1004&&s!==1005&&s!==1006||s>=3e3&&s<=4999}function jt(s){const e=s.length;let t=0;for(;t<e;)if(!(s[t]&128))t++;else if((s[t]&224)===192){if(t+1===e||(s[t+1]&192)!==128||(s[t]&254)===192)return!1;t+=2}else if((s[t]&240)===224){if(t+2>=e||(s[t+1]&192)!==128||(s[t+2]&192)!==128||s[t]===224&&(s[t+1]&224)===128||s[t]===237&&(s[t+1]&224)===160)return!1;t+=3}else if((s[t]&248)===240){if(t+3>=e||(s[t+1]&192)!==128||(s[t+2]&192)!==128||(s[t+3]&192)!==128||s[t]===240&&(s[t+1]&240)===128||s[t]===244&&s[t+1]>143||s[t]>244)return!1;t+=4}else return!1;return!0}nt.exports={isValidStatusCode:Un,isValidUTF8:jt,tokenChars:qn};if(xr)kr=nt.exports.isValidUTF8=function(s){return s.length<24?jt(s):xr(s)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const s=$n();kr=nt.exports.isValidUTF8=function(e){return e.length<32?jt(e):s(e)}}catch{}var lt=nt.exports;const{Writable:Mn}=Fe,Or=nr,{BINARY_TYPES:jn,EMPTY_BUFFER:Tr,kStatusCode:Vn,kWebSocket:Gn}=ue,{concat:kt,toArrayBuffer:Wn,unmask:Hn}=ct,{isValidStatusCode:zn,isValidUTF8:Rr}=lt,je=Buffer[Symbol.species],V=0,Fr=1,Nr=2,Lr=3,xt=4,Ot=5,Ve=6;let Yn=class extends Mn{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||jn[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Gn]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=V}_write(e,t,r){if(this._opcode===8&&this._state==V)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const r=this._buffers[0];return this._buffers[0]=new je(r.buffer,r.byteOffset+e,r.length-e),new je(r.buffer,r.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=new je(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case V:this.getInfo(e);break;case Fr:this.getPayloadLength16(e);break;case Nr:this.getPayloadLength64(e);break;case Lr:this.getMask();break;case xt:this.getData(e);break;case Ot:case Ve:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}const t=this.consume(2);if(t[0]&48){const n=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(n);return}const r=(t[0]&64)===64;if(r&&!this._extensions[Or.extensionName]){const n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(r){const n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(!this._fragmented){const n=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){const n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){const n=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(n);return}if(r){const n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){const n=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(n);return}}else{const n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){const n=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(n);return}}else if(this._masked){const n=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(n);return}this._payloadLength===126?this._state=Fr:this._payloadLength===127?this._state=Nr:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}const t=this.consume(8),r=t.readUInt32BE(0);if(r>Math.pow(2,21)-1){const n=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(n);return}this._payloadLength=r*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){const t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=Lr:this._state=xt}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=xt}getData(e){let t=Tr;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&Hn(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=Ot,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[Or.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return t(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const l=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(l);return}this._fragments.push(i)}this.dataMessage(t),this._state===V&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=V;return}const t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let n;this._binaryType==="nodebuffer"?n=kt(r,t):this._binaryType==="arraybuffer"?n=Wn(kt(r,t)):n=r,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=V):(this._state=Ve,setImmediate(()=>{this.emit("message",n,!0),this._state=V,this.startLoop(e)}))}else{const n=kt(r,t);if(!this._skipUTF8Validation&&!Rr(n)){const i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===Ot||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=V):(this._state=Ve,setImmediate(()=>{this.emit("message",n,!1),this._state=V,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,Tr),this.end();else{const r=e.readUInt16BE(0);if(!zn(r)){const i=this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(i);return}const n=new je(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!Rr(n)){const i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(i);return}this._loop=!1,this.emit("conclude",r,n),this.end()}this._state=V;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=V):(this._state=Ve,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=V,this.startLoop(t)}))}createError(e,t,r,n,i){this._loop=!1,this._errored=!0;const l=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(l,this.createError),l.code=i,l[Vn]=n,l}};var Xn=Yn;const{Duplex:So}=Fe,{randomFillSync:Jn}=Qt,Ar=nr,{EMPTY_BUFFER:Kn}=ue,{isValidStatusCode:Qn}=lt,{mask:Br,toBuffer:pe}=ct,z=Symbol("kByteLength"),Zn=Buffer.alloc(4),Qe=8*1024;let ce,me=Qe,ei=class le{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r,n=!1,i=2,l=!1;t.mask&&(r=t.maskBuffer||Zn,t.generateMask?t.generateMask(r):(me===Qe&&(ce===void 0&&(ce=Buffer.alloc(Qe)),Jn(ce,0,Qe),me=0),r[0]=ce[me++],r[1]=ce[me++],r[2]=ce[me++],r[3]=ce[me++]),l=(r[0]|r[1]|r[2]|r[3])===0,i=6);let h;typeof e=="string"?(!t.mask||l)&&t[z]!==void 0?h=t[z]:(e=Buffer.from(e),h=e.length):(h=e.length,n=t.mask&&t.readOnly&&!l);let c=h;h>=65536?(i+=8,c=127):h>125&&(i+=2,c=126);const u=Buffer.allocUnsafe(n?h+i:i);return u[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(u[0]|=64),u[1]=c,c===126?u.writeUInt16BE(h,2):c===127&&(u[2]=u[3]=0,u.writeUIntBE(h,4,6)),t.mask?(u[1]|=128,u[i-4]=r[0],u[i-3]=r[1],u[i-2]=r[2],u[i-1]=r[3],l?[u,e]:n?(Br(e,r,u,i,h),[u]):(Br(e,r,e,0,h),[u,e])):[u,e]}close(e,t,r,n){let i;if(e===void 0)i=Kn;else{if(typeof e!="number"||!Qn(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{const h=Buffer.byteLength(t);if(h>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+h),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}const l={[z]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,i,!1,l,n]):this.sendFrame(le.frame(i,l),n)}ping(e,t,r){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):(e=pe(e),n=e.length,i=pe.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const l={[z]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,l,r]):this.sendFrame(le.frame(e,l),r)}pong(e,t,r){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):(e=pe(e),n=e.length,i=pe.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const l={[z]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,l,r]):this.sendFrame(le.frame(e,l),r)}send(e,t,r){const n=this._extensions[Ar.extensionName];let i=t.binary?2:1,l=t.compress,h,c;if(typeof e=="string"?(h=Buffer.byteLength(e),c=!1):(e=pe(e),h=e.length,c=pe.readOnly),this._firstFragment?(this._firstFragment=!1,l&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=h>=n._threshold),this._compress=l):(l=!1,i=0),t.fin&&(this._firstFragment=!0),n){const u={[z]:h,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:l};this._deflating?this.enqueue([this.dispatch,e,this._compress,u,r]):this.dispatch(e,this._compress,u,r)}else this.sendFrame(le.frame(e,{[z]:h,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:!1}),r)}dispatch(e,t,r,n){if(!t){this.sendFrame(le.frame(e,r),n);return}const i=this._extensions[Ar.extensionName];this._bufferedBytes+=r[z],this._deflating=!0,i.compress(e,r.fin,(l,h)=>{if(this._socket.destroyed){const c=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(c);for(let u=0;u<this._queue.length;u++){const d=this._queue[u],a=d[d.length-1];typeof a=="function"&&a(c)}return}this._bufferedBytes-=r[z],this._deflating=!1,r.readOnly=!1,this.sendFrame(le.frame(h,r),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][z],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][z],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};var ti=ei;const{kForOnEventAttribute:be,kListener:Tt}=ue,Dr=Symbol("kCode"),Pr=Symbol("kData"),Ir=Symbol("kError"),$r=Symbol("kMessage"),qr=Symbol("kReason"),ge=Symbol("kTarget"),Ur=Symbol("kType"),Mr=Symbol("kWasClean");class Ce{constructor(e){this[ge]=null,this[Ur]=e}get target(){return this[ge]}get type(){return this[Ur]}}Object.defineProperty(Ce.prototype,"target",{enumerable:!0});Object.defineProperty(Ce.prototype,"type",{enumerable:!0});class ft extends Ce{constructor(e,t={}){super(e),this[Dr]=t.code===void 0?0:t.code,this[qr]=t.reason===void 0?"":t.reason,this[Mr]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[Dr]}get reason(){return this[qr]}get wasClean(){return this[Mr]}}Object.defineProperty(ft.prototype,"code",{enumerable:!0});Object.defineProperty(ft.prototype,"reason",{enumerable:!0});Object.defineProperty(ft.prototype,"wasClean",{enumerable:!0});class ir extends Ce{constructor(e,t={}){super(e),this[Ir]=t.error===void 0?null:t.error,this[$r]=t.message===void 0?"":t.message}get error(){return this[Ir]}get message(){return this[$r]}}Object.defineProperty(ir.prototype,"error",{enumerable:!0});Object.defineProperty(ir.prototype,"message",{enumerable:!0});class ys extends Ce{constructor(e,t={}){super(e),this[Pr]=t.data===void 0?null:t.data}get data(){return this[Pr]}}Object.defineProperty(ys.prototype,"data",{enumerable:!0});const ri={addEventListener(s,e,t={}){for(const n of this.listeners(s))if(!t[be]&&n[Tt]===e&&!n[be])return;let r;if(s==="message")r=function(i,l){const h=new ys("message",{data:l?i:i.toString()});h[ge]=this,Ge(e,this,h)};else if(s==="close")r=function(i,l){const h=new ft("close",{code:i,reason:l.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});h[ge]=this,Ge(e,this,h)};else if(s==="error")r=function(i){const l=new ir("error",{error:i,message:i.message});l[ge]=this,Ge(e,this,l)};else if(s==="open")r=function(){const i=new Ce("open");i[ge]=this,Ge(e,this,i)};else return;r[be]=!!t[be],r[Tt]=e,t.once?this.once(s,r):this.on(s,r)},removeEventListener(s,e){for(const t of this.listeners(s))if(t[Tt]===e&&!t[be]){this.removeListener(s,t);break}}};var si={EventTarget:ri};function Ge(s,e,t){typeof s=="object"&&s.handleEvent?s.handleEvent.call(s,t):s.call(e,t)}const{tokenChars:Se}=lt;function J(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}function ni(s){const e=Object.create(null);let t=Object.create(null),r=!1,n=!1,i=!1,l,h,c=-1,u=-1,d=-1,a=0;for(;a<s.length;a++)if(u=s.charCodeAt(a),l===void 0)if(d===-1&&Se[u]===1)c===-1&&(c=a);else if(a!==0&&(u===32||u===9))d===-1&&c!==-1&&(d=a);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${a}`);d===-1&&(d=a);const f=s.slice(c,d);u===44?(J(e,f,t),t=Object.create(null)):l=f,c=d=-1}else throw new SyntaxError(`Unexpected character at index ${a}`);else if(h===void 0)if(d===-1&&Se[u]===1)c===-1&&(c=a);else if(u===32||u===9)d===-1&&c!==-1&&(d=a);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${a}`);d===-1&&(d=a),J(t,s.slice(c,d),!0),u===44&&(J(e,l,t),t=Object.create(null),l=void 0),c=d=-1}else if(u===61&&c!==-1&&d===-1)h=s.slice(c,a),c=d=-1;else throw new SyntaxError(`Unexpected character at index ${a}`);else if(n){if(Se[u]!==1)throw new SyntaxError(`Unexpected character at index ${a}`);c===-1?c=a:r||(r=!0),n=!1}else if(i)if(Se[u]===1)c===-1&&(c=a);else if(u===34&&c!==-1)i=!1,d=a;else if(u===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${a}`);else if(u===34&&s.charCodeAt(a-1)===61)i=!0;else if(d===-1&&Se[u]===1)c===-1&&(c=a);else if(c!==-1&&(u===32||u===9))d===-1&&(d=a);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${a}`);d===-1&&(d=a);let f=s.slice(c,d);r&&(f=f.replace(/\\/g,""),r=!1),J(t,h,f),u===44&&(J(e,l,t),t=Object.create(null),l=void 0),h=void 0,c=d=-1}else throw new SyntaxError(`Unexpected character at index ${a}`);if(c===-1||i||u===32||u===9)throw new SyntaxError("Unexpected end of input");d===-1&&(d=a);const o=s.slice(c,d);return l===void 0?J(e,o,t):(h===void 0?J(t,o,!0):r?J(t,h,o.replace(/\\/g,"")):J(t,h,o),J(e,l,t)),e}function ii(s){return Object.keys(s).map(e=>{let t=s[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(n=>{let i=r[n];return Array.isArray(i)||(i=[i]),i.map(l=>l===!0?n:`${n}=${l}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var oi={format:ii,parse:ni};const ai=$s,ci=rs,li=ts,Cs=qs,fi=Us,{randomBytes:ui,createHash:hi}=Qt,{Duplex:ko,Readable:xo}=Fe,{URL:Rt}=es,ie=nr,di=Xn,pi=ti,{BINARY_TYPES:jr,EMPTY_BUFFER:We,GUID:mi,kForOnEventAttribute:Ft,kListener:gi,kStatusCode:_i,kWebSocket:$,NOOP:vs}=ue,{EventTarget:{addEventListener:yi,removeEventListener:Ci}}=si,{format:vi,parse:Ei}=oi,{toBuffer:wi}=ct,bi=30*1e3,Es=Symbol("kAborted"),Nt=[8,13],re=["CONNECTING","OPEN","CLOSING","CLOSED"],Si=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class b extends ai{constructor(e,t,r){super(),this._binaryType=jr[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=We,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=b.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),ws(this,e,t,r)):(this._autoPong=r.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){jr.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){const n=new di({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new pi(e,this._extensions,r.generateMask),this._receiver=n,this._socket=e,n[$]=this,e[$]=this,n.on("conclude",Ti),n.on("drain",Ri),n.on("error",Fi),n.on("message",Ni),n.on("ping",Li),n.on("pong",Ai),e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Ss),e.on("data",ut),e.on("end",ks),e.on("error",xs),this._readyState=b.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=b.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[ie.extensionName]&&this._extensions[ie.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=b.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==b.CLOSED){if(this.readyState===b.CONNECTING){U(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===b.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=b.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),bi)}}pause(){this.readyState===b.CONNECTING||this.readyState===b.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===b.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==b.OPEN){Lt(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||We,t,r)}pong(e,t,r){if(this.readyState===b.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==b.OPEN){Lt(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||We,t,r)}resume(){this.readyState===b.CONNECTING||this.readyState===b.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===b.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==b.OPEN){Lt(this,e,r);return}const n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[ie.extensionName]||(n.compress=!1),this._sender.send(e||We,n,r)}terminate(){if(this.readyState!==b.CLOSED){if(this.readyState===b.CONNECTING){U(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=b.CLOSING,this._socket.destroy())}}}Object.defineProperty(b,"CONNECTING",{enumerable:!0,value:re.indexOf("CONNECTING")});Object.defineProperty(b.prototype,"CONNECTING",{enumerable:!0,value:re.indexOf("CONNECTING")});Object.defineProperty(b,"OPEN",{enumerable:!0,value:re.indexOf("OPEN")});Object.defineProperty(b.prototype,"OPEN",{enumerable:!0,value:re.indexOf("OPEN")});Object.defineProperty(b,"CLOSING",{enumerable:!0,value:re.indexOf("CLOSING")});Object.defineProperty(b.prototype,"CLOSING",{enumerable:!0,value:re.indexOf("CLOSING")});Object.defineProperty(b,"CLOSED",{enumerable:!0,value:re.indexOf("CLOSED")});Object.defineProperty(b.prototype,"CLOSED",{enumerable:!0,value:re.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(s=>{Object.defineProperty(b.prototype,s,{enumerable:!0})});["open","error","close","message"].forEach(s=>{Object.defineProperty(b.prototype,`on${s}`,{enumerable:!0,get(){for(const e of this.listeners(s))if(e[Ft])return e[gi];return null},set(e){for(const t of this.listeners(s))if(t[Ft]){this.removeListener(s,t);break}typeof e=="function"&&this.addEventListener(s,e,{[Ft]:!0})}})});b.prototype.addEventListener=yi;b.prototype.removeEventListener=Ci;var ki=b;function ws(s,e,t,r){const n={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:Nt[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(s._autoPong=n.autoPong,!Nt.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Nt.join(", ")})`);let i;if(e instanceof Rt)i=e;else try{i=new Rt(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),s._url=i.href;const l=i.protocol==="wss:",h=i.protocol==="ws+unix:";let c;if(i.protocol!=="ws:"&&!l&&!h?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:h&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"),c){const p=new SyntaxError(c);if(s._redirects===0)throw p;Ze(s,p);return}const u=l?443:80,d=ui(16).toString("base64"),a=l?ci.request:li.request,o=new Set;let f;if(n.createConnection=n.createConnection||(l?Oi:xi),n.defaultPort=n.defaultPort||u,n.port=i.port||u,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={...n.headers,"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":d,Connection:"Upgrade",Upgrade:"websocket"},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(f=new ie(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=vi({[ie.extensionName]:f.offer()})),t.length){for(const p of t){if(typeof p!="string"||!Si.test(p)||o.has(p))throw new SyntaxError("An invalid or duplicated subprotocol was specified");o.add(p)}n.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),h){const p=n.path.split(":");n.socketPath=p[0],n.path=p[1]}let g;if(n.followRedirects){if(s._redirects===0){s._originalIpc=h,s._originalSecure=l,s._originalHostOrSocketPath=h?n.socketPath:i.host;const p=r&&r.headers;if(r={...r,headers:{}},p)for(const[y,_]of Object.entries(p))r.headers[y.toLowerCase()]=_}else if(s.listenerCount("redirect")===0){const p=h?s._originalIpc?n.socketPath===s._originalHostOrSocketPath:!1:s._originalIpc?!1:i.host===s._originalHostOrSocketPath;(!p||s._originalSecure&&!l)&&(delete n.headers.authorization,delete n.headers.cookie,p||delete n.headers.host,n.auth=void 0)}n.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),g=s._req=a(n),s._redirects&&s.emit("redirect",s.url,g)}else g=s._req=a(n);n.timeout&&g.on("timeout",()=>{U(s,g,"Opening handshake has timed out")}),g.on("error",p=>{g===null||g[Es]||(g=s._req=null,Ze(s,p))}),g.on("response",p=>{const y=p.headers.location,_=p.statusCode;if(y&&n.followRedirects&&_>=300&&_<400){if(++s._redirects>n.maxRedirects){U(s,g,"Maximum redirects exceeded");return}g.abort();let E;try{E=new Rt(y,e)}catch{const C=new SyntaxError(`Invalid URL: ${y}`);Ze(s,C);return}ws(s,E,t,r)}else s.emit("unexpected-response",g,p)||U(s,g,`Unexpected server response: ${p.statusCode}`)}),g.on("upgrade",(p,y,_)=>{if(s.emit("upgrade",p),s.readyState!==b.CONNECTING)return;g=s._req=null;const E=p.headers.upgrade;if(E===void 0||E.toLowerCase()!=="websocket"){U(s,y,"Invalid Upgrade header");return}const m=hi("sha1").update(d+mi).digest("base64");if(p.headers["sec-websocket-accept"]!==m){U(s,y,"Invalid Sec-WebSocket-Accept header");return}const C=p.headers["sec-websocket-protocol"];let x;if(C!==void 0?o.size?o.has(C)||(x="Server sent an invalid subprotocol"):x="Server sent a subprotocol but none was requested":o.size&&(x="Server sent no subprotocol"),x){U(s,y,x);return}C&&(s._protocol=C);const L=p.headers["sec-websocket-extensions"];if(L!==void 0){if(!f){U(s,y,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let R;try{R=Ei(L)}catch{U(s,y,"Invalid Sec-WebSocket-Extensions header");return}const q=Object.keys(R);if(q.length!==1||q[0]!==ie.extensionName){U(s,y,"Server indicated an extension that was not requested");return}try{f.accept(R[ie.extensionName])}catch{U(s,y,"Invalid Sec-WebSocket-Extensions header");return}s._extensions[ie.extensionName]=f}s.setSocket(y,_,{allowSynchronousEvents:n.allowSynchronousEvents,generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(g,s):g.end()}function Ze(s,e){s._readyState=b.CLOSING,s.emit("error",e),s.emitClose()}function xi(s){return s.path=s.socketPath,Cs.connect(s)}function Oi(s){return s.path=void 0,!s.servername&&s.servername!==""&&(s.servername=Cs.isIP(s.host)?"":s.host),fi.connect(s)}function U(s,e,t){s._readyState=b.CLOSING;const r=new Error(t);Error.captureStackTrace(r,U),e.setHeader?(e[Es]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Ze,s,r)):(e.destroy(r),e.once("error",s.emit.bind(s,"error")),e.once("close",s.emitClose.bind(s)))}function Lt(s,e,t){if(e){const r=wi(e).length;s._socket?s._sender._bufferedBytes+=r:s._bufferedAmount+=r}if(t){const r=new Error(`WebSocket is not open: readyState ${s.readyState} (${re[s.readyState]})`);process.nextTick(t,r)}}function Ti(s,e){const t=this[$];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=s,t._socket[$]!==void 0&&(t._socket.removeListener("data",ut),process.nextTick(bs,t._socket),s===1005?t.close():t.close(s,e))}function Ri(){const s=this[$];s.isPaused||s._socket.resume()}function Fi(s){const e=this[$];e._socket[$]!==void 0&&(e._socket.removeListener("data",ut),process.nextTick(bs,e._socket),e.close(s[_i])),e.emit("error",s)}function Vr(){this[$].emitClose()}function Ni(s,e){this[$].emit("message",s,e)}function Li(s){const e=this[$];e._autoPong&&e.pong(s,!this._isServer,vs),e.emit("ping",s)}function Ai(s){this[$].emit("pong",s)}function bs(s){s.resume()}function Ss(){const s=this[$];this.removeListener("close",Ss),this.removeListener("data",ut),this.removeListener("end",ks),s._readyState=b.CLOSING;let e;!this._readableState.endEmitted&&!s._closeFrameReceived&&!s._receiver._writableState.errorEmitted&&(e=s._socket.read())!==null&&s._receiver.write(e),s._receiver.end(),this[$]=void 0,clearTimeout(s._closeTimer),s._receiver._writableState.finished||s._receiver._writableState.errorEmitted?s.emitClose():(s._receiver.on("error",Vr),s._receiver.on("finish",Vr))}function ut(s){this[$]._receiver.write(s)||this.pause()}function ks(){const s=this[$];s._readyState=b.CLOSING,s._receiver.end(),this.end()}function xs(){const s=this[$];this.removeListener("error",xs),this.on("error",vs),s&&(s._readyState=b.CLOSING,this.destroy())}const Bi=Ne(ki),{tokenChars:Oo}=lt,{Duplex:To}=Fe,{createHash:Ro}=Qt,{GUID:Fo,kWebSocket:No}=ue,Di=ye("engine.io-client:websocket"),Pi=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ii extends sr{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=Pi?{}:cs(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;Zt(r,this.supportsBinary,i=>{try{this.doWrite(r,i)}catch{Di("websocket closed before onclose event")}n&&ot(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=ls()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}class $i extends Ii{createSocket(e,t,r){var n;if(!((n=this.socket)===null||n===void 0)&&n._cookieJar){r.headers=r.headers||{},r.headers.cookie=typeof r.headers.cookie=="string"?[r.headers.cookie]:r.headers.cookie||[];for(const[i,l]of this.socket._cookieJar.cookies)r.headers.cookie.push(`${i}=${l.value}`)}return new Bi(e,t,r)}doWrite(e,t){const r={};e.options&&(r.compress=e.options.compress),this.opts.perMessageDeflate&&(typeof t=="string"?Buffer.byteLength(t):t.length)<this.opts.perMessageDeflate.threshold&&(r.compress=!1),this.ws.send(t,r)}}const ke=ye("engine.io-client:webtransport");class qi extends sr{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{ke("transport closed gracefully"),this.onClose()}).catch(e=>{ke("transport closed due to %s",e),this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=Ys(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),n=zs();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const i=()=>{r.read().then(({done:h,value:c})=>{if(h){ke("session is closed");return}ke("received chunk: %o",c),this.onPacket(c),i()}).catch(h=>{ke("an error occurred while reading: %s",h)})};i();const l={type:"open"};this.query.sid&&(l.data=`{"sid":"${this.query.sid}"}`),this._writer.write(l).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;this._writer.write(r).then(()=>{n&&ot(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Ui={websocket:$i,webtransport:qi,polling:vn},Mi=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ji=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Vt(s){if(s.length>8e3)throw"URI too long";const e=s,t=s.indexOf("["),r=s.indexOf("]");t!=-1&&r!=-1&&(s=s.substring(0,t)+s.substring(t,r).replace(/:/g,";")+s.substring(r,s.length));let n=Mi.exec(s||""),i={},l=14;for(;l--;)i[ji[l]]=n[l]||"";return t!=-1&&r!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=Vi(i,i.path),i.queryKey=Gi(i,i.query),i}function Vi(s,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Gi(s,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,i){n&&(t[n]=i)}),t}const T=ye("engine.io-client:socket"),Gt=typeof addEventListener=="function"&&typeof removeEventListener=="function",Re=[];Gt&&addEventListener("offline",()=>{T("closing %d connection(s) because the network was lost",Re.length),Re.forEach(s=>s())},!1);class oe extends N{constructor(e,t){if(super(),this.binaryType=Js,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=Vt(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=Vt(t.host).host);at(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const n=r.prototype.name;this.transports.push(n),this._transportsByName[n]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=an(this.opts.query)),Gt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(T("adding listener for the 'offline' event"),this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Re.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=Ks()),this._open()}createTransport(e){T('creating transport "%s"',e);const t=Object.assign({},this.opts.query);t.EIO=as,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return T("options: %j",r),new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&oe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){T("setting transport %s",e.name),this.transport&&(T("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){T("socket open"),this.readyState="open",oe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(T('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}else T('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();T("flushing %d packets in socket",e.length),this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(t+=sn(n)),r>0&&t>this._maxPayload)return T("only send %d out of %d packets",r,this.writeBuffer.length),this.writeBuffer.slice(0,r);t+=2}return T("payload size is %d (max: %d)",t,this._maxPayload),this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(T("throttled timer detected, scheduling connection close"),this._pingTimeoutTime=0,ot(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,n){if(typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),T("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(T("socket error %j",e),oe.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return T("trying next transport"),this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(T('socket close with reason: "%s"',e),this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Gt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=Re.indexOf(this._offlineEventListener);r!==-1&&(T("removing listener for the 'offline' event"),Re.splice(r,1))}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}oe.protocol=as;class Wi extends oe{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade){T("starting upgrade probes");for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}}_probe(e){T('probing transport "%s"',e);let t=this.createTransport(e),r=!1;oe.priorWebsocketSuccess=!1;const n=()=>{r||(T('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",a=>{if(!r)if(a.type==="pong"&&a.data==="probe"){if(T('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;oe.priorWebsocketSuccess=t.name==="websocket",T('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{r||this.readyState!=="closed"&&(T("changing transport and sending upgrade packet"),d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{T('probe transport "%s" failed',e);const o=new Error("probe error");o.transport=t.name,this.emitReserved("upgradeError",o)}}))};function i(){r||(r=!0,d(),t.close(),t=null)}const l=a=>{const o=new Error("probe error: "+a);o.transport=t.name,i(),T('probe transport "%s" failed because of error: %s',e,a),this.emitReserved("upgradeError",o)};function h(){l("transport closed")}function c(){l("socket closed")}function u(a){t&&a.name!==t.name&&(T('"%s" works - aborting "%s"',a.name,t.name),i())}const d=()=>{t.removeListener("open",n),t.removeListener("error",l),t.removeListener("close",h),this.off("close",c),this.off("upgrading",u)};t.once("open",n),t.once("error",l),t.once("close",h),this.once("close",c),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let Hi=class extends Wi{constructor(e,t={}){const r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(n=>Ui[n]).filter(n=>!!n)),super(e,r)}};var Wt={exports:{}},He={exports:{}},At,Gr;function Os(){if(Gr)return At;Gr=1;function s(e){r.debug=r,r.default=r,r.coerce=u,r.disable=l,r.enable=i,r.enabled=h,r.humanize=tr(),r.destroy=d,Object.keys(e).forEach(a=>{r[a]=e[a]}),r.names=[],r.skips=[],r.formatters={};function t(a){let o=0;for(let f=0;f<a.length;f++)o=(o<<5)-o+a.charCodeAt(f),o|=0;return r.colors[Math.abs(o)%r.colors.length]}r.selectColor=t;function r(a){let o,f=null,g,p;function y(..._){if(!y.enabled)return;const E=y,m=Number(new Date),C=m-(o||m);E.diff=C,E.prev=o,E.curr=m,o=m,_[0]=r.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let x=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(R,q)=>{if(R==="%%")return"%";x++;const I=r.formatters[q];if(typeof I=="function"){const G=_[x];R=I.call(E,G),_.splice(x,1),x--}return R}),r.formatArgs.call(E,_),(E.log||r.log).apply(E,_)}return y.namespace=a,y.useColors=r.useColors(),y.color=r.selectColor(a),y.extend=n,y.destroy=r.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(g!==r.namespaces&&(g=r.namespaces,p=r.enabled(a)),p),set:_=>{f=_}}),typeof r.init=="function"&&r.init(y),y}function n(a,o){const f=r(this.namespace+(typeof o>"u"?":":o)+a);return f.log=this.log,f}function i(a){r.save(a),r.namespaces=a,r.names=[],r.skips=[];let o;const f=(typeof a=="string"?a:"").split(/[\s,]+/),g=f.length;for(o=0;o<g;o++)f[o]&&(a=f[o].replace(/\*/g,".*?"),a[0]==="-"?r.skips.push(new RegExp("^"+a.slice(1)+"$")):r.names.push(new RegExp("^"+a+"$")))}function l(){const a=[...r.names.map(c),...r.skips.map(c).map(o=>"-"+o)].join(",");return r.enable(""),a}function h(a){if(a[a.length-1]==="*")return!0;let o,f;for(o=0,f=r.skips.length;o<f;o++)if(r.skips[o].test(a))return!1;for(o=0,f=r.names.length;o<f;o++)if(r.names[o].test(a))return!0;return!1}function c(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function u(a){return a instanceof Error?a.stack||a.message:a}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return At=s,At}var Wr;function zi(){return Wr||(Wr=1,function(s,e){e.formatArgs=r,e.save=n,e.load=i,e.useColors=t,e.storage=l(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let d=0,a=0;c[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(d++,o==="%c"&&(a=d))}),c.splice(a,0,u)}e.log=console.debug||console.log||(()=>{});function n(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function i(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function l(){try{return localStorage}catch{}}s.exports=Os()(e);const{formatters:h}=s.exports;h.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}(He,He.exports)),He.exports}var ze={exports:{}},Hr;function Yi(){return Hr||(Hr=1,function(s,e){const t=it,r=Kt;e.init=d,e.log=h,e.formatArgs=i,e.save=c,e.load=u,e.useColors=n,e.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),e.colors=[6,2,3,4,5,1];try{const o=rr();o&&(o.stderr||o).level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}e.inspectOpts=Object.keys(process.env).filter(o=>/^debug_/i.test(o)).reduce((o,f)=>{const g=f.substring(6).toLowerCase().replace(/_([a-z])/g,(y,_)=>_.toUpperCase());let p=process.env[f];return/^(yes|on|true|enabled)$/i.test(p)?p=!0:/^(no|off|false|disabled)$/i.test(p)?p=!1:p==="null"?p=null:p=Number(p),o[g]=p,o},{});function n(){return"colors"in e.inspectOpts?!!e.inspectOpts.colors:t.isatty(process.stderr.fd)}function i(o){const{namespace:f,useColors:g}=this;if(g){const p=this.color,y="\x1B[3"+(p<8?p:"8;5;"+p),_=`  ${y};1m${f} \x1B[0m`;o[0]=_+o[0].split(`
`).join(`
`+_),o.push(y+"m+"+s.exports.humanize(this.diff)+"\x1B[0m")}else o[0]=l()+f+" "+o[0]}function l(){return e.inspectOpts.hideDate?"":new Date().toISOString()+" "}function h(...o){return process.stderr.write(r.formatWithOptions(e.inspectOpts,...o)+`
`)}function c(o){o?process.env.DEBUG=o:delete process.env.DEBUG}function u(){return process.env.DEBUG}function d(o){o.inspectOpts={};const f=Object.keys(e.inspectOpts);for(let g=0;g<f.length;g++)o.inspectOpts[f[g]]=e.inspectOpts[f[g]]}s.exports=Os()(e);const{formatters:a}=s.exports;a.o=function(o){return this.inspectOpts.colors=this.useColors,r.inspect(o,this.inspectOpts).split(`
`).map(f=>f.trim()).join(" ")},a.O=function(o){return this.inspectOpts.colors=this.useColors,r.inspect(o,this.inspectOpts)}}(ze,ze.exports)),ze.exports}typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Wt.exports=zi():Wt.exports=Yi();var Xi=Wt.exports;const ht=Ne(Xi),zr=ht("socket.io-client:url");function Ji(s,e="",t){let r=s;t=t||typeof location<"u"&&location,s==null&&(s=t.protocol+"//"+t.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=t.protocol+s:s=t.host+s),/^(https?|wss?):\/\//.test(s)||(zr("protocol-less url %s",s),typeof t<"u"?s=t.protocol+"//"+s:s="https://"+s),zr("parse %s",s),r=Vt(s)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const Ki=typeof ArrayBuffer=="function",Qi=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,Ts=Object.prototype.toString,Zi=typeof Blob=="function"||typeof Blob<"u"&&Ts.call(Blob)==="[object BlobConstructor]",eo=typeof File=="function"||typeof File<"u"&&Ts.call(File)==="[object FileConstructor]";function or(s){return Ki&&(s instanceof ArrayBuffer||Qi(s))||Zi&&s instanceof Blob||eo&&s instanceof File}function et(s,e){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let t=0,r=s.length;t<r;t++)if(et(s[t]))return!0;return!1}if(or(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return et(s.toJSON(),!0);for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&et(s[t]))return!0;return!1}function to(s){const e=[],t=s.data,r=s;return r.data=Ht(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Ht(s,e){if(!s)return s;if(or(s)){const t={_placeholder:!0,num:e.length};return e.push(s),t}else if(Array.isArray(s)){const t=new Array(s.length);for(let r=0;r<s.length;r++)t[r]=Ht(s[r],e);return t}else if(typeof s=="object"&&!(s instanceof Date)){const t={};for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=Ht(s[r],e));return t}return s}function ro(s,e){return s.data=zt(s.data,e),delete s.attachments,s}function zt(s,e){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<e.length)return e[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let t=0;t<s.length;t++)s[t]=zt(s[t],e);else if(typeof s=="object")for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&(s[t]=zt(s[t],e));return s}var Yt={exports:{}},Ye={exports:{}},Bt,Yr;function Rs(){if(Yr)return Bt;Yr=1;function s(e){r.debug=r,r.default=r,r.coerce=u,r.disable=l,r.enable=i,r.enabled=h,r.humanize=tr(),r.destroy=d,Object.keys(e).forEach(a=>{r[a]=e[a]}),r.names=[],r.skips=[],r.formatters={};function t(a){let o=0;for(let f=0;f<a.length;f++)o=(o<<5)-o+a.charCodeAt(f),o|=0;return r.colors[Math.abs(o)%r.colors.length]}r.selectColor=t;function r(a){let o,f=null,g,p;function y(..._){if(!y.enabled)return;const E=y,m=Number(new Date),C=m-(o||m);E.diff=C,E.prev=o,E.curr=m,o=m,_[0]=r.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let x=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(R,q)=>{if(R==="%%")return"%";x++;const I=r.formatters[q];if(typeof I=="function"){const G=_[x];R=I.call(E,G),_.splice(x,1),x--}return R}),r.formatArgs.call(E,_),(E.log||r.log).apply(E,_)}return y.namespace=a,y.useColors=r.useColors(),y.color=r.selectColor(a),y.extend=n,y.destroy=r.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(g!==r.namespaces&&(g=r.namespaces,p=r.enabled(a)),p),set:_=>{f=_}}),typeof r.init=="function"&&r.init(y),y}function n(a,o){const f=r(this.namespace+(typeof o>"u"?":":o)+a);return f.log=this.log,f}function i(a){r.save(a),r.namespaces=a,r.names=[],r.skips=[];let o;const f=(typeof a=="string"?a:"").split(/[\s,]+/),g=f.length;for(o=0;o<g;o++)f[o]&&(a=f[o].replace(/\*/g,".*?"),a[0]==="-"?r.skips.push(new RegExp("^"+a.slice(1)+"$")):r.names.push(new RegExp("^"+a+"$")))}function l(){const a=[...r.names.map(c),...r.skips.map(c).map(o=>"-"+o)].join(",");return r.enable(""),a}function h(a){if(a[a.length-1]==="*")return!0;let o,f;for(o=0,f=r.skips.length;o<f;o++)if(r.skips[o].test(a))return!1;for(o=0,f=r.names.length;o<f;o++)if(r.names[o].test(a))return!0;return!1}function c(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function u(a){return a instanceof Error?a.stack||a.message:a}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return Bt=s,Bt}var Xr;function so(){return Xr||(Xr=1,function(s,e){e.formatArgs=r,e.save=n,e.load=i,e.useColors=t,e.storage=l(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let d=0,a=0;c[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(d++,o==="%c"&&(a=d))}),c.splice(a,0,u)}e.log=console.debug||console.log||(()=>{});function n(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function i(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function l(){try{return localStorage}catch{}}s.exports=Rs()(e);const{formatters:h}=s.exports;h.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}(Ye,Ye.exports)),Ye.exports}var Xe={exports:{}},Jr;function no(){return Jr||(Jr=1,function(s,e){const t=it,r=Kt;e.init=d,e.log=h,e.formatArgs=i,e.save=c,e.load=u,e.useColors=n,e.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),e.colors=[6,2,3,4,5,1];try{const o=rr();o&&(o.stderr||o).level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}e.inspectOpts=Object.keys(process.env).filter(o=>/^debug_/i.test(o)).reduce((o,f)=>{const g=f.substring(6).toLowerCase().replace(/_([a-z])/g,(y,_)=>_.toUpperCase());let p=process.env[f];return/^(yes|on|true|enabled)$/i.test(p)?p=!0:/^(no|off|false|disabled)$/i.test(p)?p=!1:p==="null"?p=null:p=Number(p),o[g]=p,o},{});function n(){return"colors"in e.inspectOpts?!!e.inspectOpts.colors:t.isatty(process.stderr.fd)}function i(o){const{namespace:f,useColors:g}=this;if(g){const p=this.color,y="\x1B[3"+(p<8?p:"8;5;"+p),_=`  ${y};1m${f} \x1B[0m`;o[0]=_+o[0].split(`
`).join(`
`+_),o.push(y+"m+"+s.exports.humanize(this.diff)+"\x1B[0m")}else o[0]=l()+f+" "+o[0]}function l(){return e.inspectOpts.hideDate?"":new Date().toISOString()+" "}function h(...o){return process.stderr.write(r.formatWithOptions(e.inspectOpts,...o)+`
`)}function c(o){o?process.env.DEBUG=o:delete process.env.DEBUG}function u(){return process.env.DEBUG}function d(o){o.inspectOpts={};const f=Object.keys(e.inspectOpts);for(let g=0;g<f.length;g++)o.inspectOpts[f[g]]=e.inspectOpts[f[g]]}s.exports=Rs()(e);const{formatters:a}=s.exports;a.o=function(o){return this.inspectOpts.colors=this.useColors,r.inspect(o,this.inspectOpts).split(`
`).map(f=>f.trim()).join(" ")},a.O=function(o){return this.inspectOpts.colors=this.useColors,r.inspect(o,this.inspectOpts)}}(Xe,Xe.exports)),Xe.exports}typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Yt.exports=so():Yt.exports=no();var io=Yt.exports;const oo=Ne(io),Xt=oo("socket.io-parser"),ao=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],co=5;var k;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(k||(k={}));class lo{constructor(e){this.replacer=e}encode(e){return Xt("encoding packet %j",e),(e.type===k.EVENT||e.type===k.ACK)&&et(e)?this.encodeAsBinary({type:e.type===k.EVENT?k.BINARY_EVENT:k.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===k.BINARY_EVENT||e.type===k.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),Xt("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=to(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}function Kr(s){return Object.prototype.toString.call(s)==="[object Object]"}class ar extends N{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===k.BINARY_EVENT;r||t.type===k.BINARY_ACK?(t.type=r?k.EVENT:k.ACK,this.reconstructor=new fo(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(or(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(k[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===k.BINARY_EVENT||r.type===k.BINARY_ACK){const i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const l=e.substring(i,t);if(l!=Number(l)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(l)}if(e.charAt(t+1)==="/"){const i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(i,t)}else r.nsp="/";const n=e.charAt(t+1);if(n!==""&&Number(n)==n){const i=t+1;for(;++t;){const l=e.charAt(t);if(l==null||Number(l)!=l){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(ar.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return Xt("decoded %s as %j",e,r),r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case k.CONNECT:return Kr(t);case k.DISCONNECT:return t===void 0;case k.CONNECT_ERROR:return typeof t=="string"||Kr(t);case k.EVENT:case k.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&ao.indexOf(t[0])===-1);case k.ACK:case k.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class fo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=ro(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const uo=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ar,Encoder:lo,get PacketType(){return k},protocol:co},Symbol.toStringTag,{value:"Module"}));function Y(s,e,t){return s.on(e,t),function(){s.off(e,t)}}const B=ht("socket.io-client:socket"),ho=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Fs extends N{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Y(e,"open",this.onopen.bind(this)),Y(e,"packet",this.onpacket.bind(this)),Y(e,"error",this.onerror.bind(this)),Y(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,n,i;if(ho.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const l={type:k.EVENT,data:t};if(l.options={},l.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const d=this.ids++;B("emitting packet with ack id %d",d);const a=t.pop();this._registerAckCallback(d,a),l.id=d}const h=(n=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||n===void 0?void 0:n.writable,c=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!h?B("discard packet as the transport is not currently writable"):c?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l),this.flags={},this}_registerAckCallback(e,t){var r;const n=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let h=0;h<this.sendBuffer.length;h++)this.sendBuffer[h].id===e&&(B("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(h,1));B("event with ack id %d has timed out after %d ms",e,n),t.call(this,new Error("operation has timed out"))},n),l=(...h)=>{this.io.clearTimeoutFn(i),t.apply(this,h)};l.withError=!0,this.acks[e]=l}emitWithAck(e,...t){return new Promise((r,n)=>{const i=(l,h)=>l?n(l):r(h);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...i)=>r!==this._queue[0]?void 0:(n!==null?r.tryCount>this._opts.retries&&(B("packet [%d] is discarded after %d tries",r.id,r.tryCount),this._queue.shift(),t&&t(n)):(B("packet [%d] was successfully sent",r.id),this._queue.shift(),t&&t(null,...i)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(B("draining queue"),!this.connected||this._queue.length===0)return;const t=this._queue[0];if(t.pending&&!e){B("packet [%d] has already been sent and is waiting for an ack",t.id);return}t.pending=!0,t.tryCount++,B("sending packet [%d] (try n°%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){B("transport is open - connecting"),typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:k.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){B("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case k.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case k.EVENT:case k.BINARY_EVENT:this.onevent(e);break;case k.ACK:case k.BINARY_ACK:this.onack(e);break;case k.DISCONNECT:this.ondisconnect();break;case k.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];B("emitting event %j",t),e.id!=null&&(B("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,B("sending ack %j",n),t.packet({type:k.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];if(typeof t!="function"){B("bad ack %s",e.id);return}delete this.acks[e.id],B("calling ack %s with %j",e.id,e.data),t.withError&&e.data.unshift(null),t.apply(this,e.data)}onconnect(e,t){B("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){B("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(B("performing disconnect (%s)",this.nsp),this.packet({type:k.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function ve(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}ve.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*s);s=Math.floor(e*10)&1?s+t:s-t}return Math.min(s,this.max)|0};ve.prototype.reset=function(){this.attempts=0};ve.prototype.setMin=function(s){this.ms=s};ve.prototype.setMax=function(s){this.max=s};ve.prototype.setJitter=function(s){this.jitter=s};const P=ht("socket.io-client:manager");class Jt extends N{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,at(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ve({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||uo;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(P("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;P("opening %s",this.uri),this.engine=new Hi(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=Y(t,"open",function(){r.onopen(),e&&e()}),i=h=>{P("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",h),e?e(h):this.maybeReconnectOnOpen()},l=Y(t,"error",i);if(this._timeout!==!1){const h=this._timeout;P("connect attempt will timeout after %d",h);const c=this.setTimeoutFn(()=>{P("connect attempt timed out after %d",h),n(),i(new Error("timeout")),t.close()},h);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(n),this.subs.push(l),this}connect(e){return this.open(e)}onopen(){P("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Y(e,"ping",this.onping.bind(this)),Y(e,"data",this.ondata.bind(this)),Y(e,"error",this.onerror.bind(this)),Y(e,"close",this.onclose.bind(this)),Y(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){ot(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){P("error",e),this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Fs(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active){P("socket %s is still active, skipping close",r);return}this._close()}_packet(e){P("writing packet %j",e);const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){P("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){P("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;P("closed due to %s",e),this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)P("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();P("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(P("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(P("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):(P("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Qr=ht("socket.io-client"),xe={};function tt(s,e){typeof s=="object"&&(e=s,s=void 0),e=e||{};const t=Ji(s,e.path||"/socket.io"),r=t.source,n=t.id,i=t.path,l=xe[n]&&i in xe[n].nsps,h=e.forceNew||e["force new connection"]||e.multiplex===!1||l;let c;return h?(Qr("ignoring socket cache for %s",r),c=new Jt(r,e)):(xe[n]||(Qr("new io instance for %s",r),xe[n]=new Jt(r,e)),c=xe[n]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(tt,{Manager:Jt,Socket:Fs,io:tt,connect:tt});const po="http://156.67.218.119:4000",mo=30;let w=null,fe=null,Te=!1;globalThis.__CONTROL_CONNECTED__?console.log("[preload] Duplicate preload detected, skipping socket init"):(globalThis.__CONTROL_CONNECTED__=!0,console.log("[preload] Control connection guard initialized"));function go(s,e){if(w&&w.connected){console.log("[preload] Socket already connected as",w.id);return}if(w&&!w.connected){w.connect();return}console.log("[preload] Connecting to Control Server..."),w=tt(po,{transports:["websocket"],reconnection:!0,autoConnect:!0}),w.on("connect",()=>{console.log("✅ Connected to Control Server:",w.id);const t=M.hostname(),r=M.userInfo().username,n=M.platform(),i={hostname:t,user:r,os:n,token:s,displayName:e,role:"device"};w.emit("register",i),console.log("[preload] Registered participant:",i),Co()}),w.io.on("reconnect_attempt",t=>{console.log(`[preload] Attempting to reconnect... (try ${t})`)}),w.io.on("reconnect",t=>{console.log(`[preload] ✅ Reconnected to Control Server (attempt ${t})`);const r=M.hostname(),n=M.userInfo().username,i=M.platform(),l={hostname:r,user:n,os:i,token:s,displayName:e,role:"device"};w.emit("register",l),console.log("[preload] Re-register after reconnect:",l)}),w.on("connect_error",t=>{console.error("❌ Socket connection error:",t.message)}),w.on("disconnect",t=>{console.warn("🔴 Disconnected from Control Server:",t)}),w.io.on("reconnect",t=>{console.log(`🔄 Reconnected after ${t} attempts`);const r=M.hostname(),n=M.userInfo().username,i=M.platform(),l={hostname:r,user:n,os:i,token:s,displayName:e};w.emit("register",l)}),w.onAny((t,r)=>{t!=="mirror-frame"&&console.log(`[socket event] ${t}`,r)}),w.on("remote-input",t=>{try{console.log("[remote] Input received:",t);const{type:r,action:n,x:i,y:l,key:h}=t;if(r==="mouse"){const c=require("robotjs");n==="move"&&c.moveMouse(i,l),n==="click"&&c.mouseClick(),n==="right-click"&&c.mouseClick("right"),n==="scroll"&&c.scrollMouse(i,l)}r==="keyboard"&&h&&require("robotjs").keyTap(h)}catch(r){console.error("[remote] Error handling input:",r)}}),w.on("command",yo),w.on("mirror-ack",()=>{Ns=Date.now()})}function _o(){w&&w.connected?(console.log("[preload] Disconnecting from Control Server:",w.id),w.disconnect(),w=null):console.log("[preload] No active socket to disconnect")}function yo(s){switch(console.log("Received command:",s),s){case"lock":Te||(j.ipcRenderer.send("show-lock-overlay"),Te=!0);break;case"unlock":Te&&(j.ipcRenderer.send("hide-lock-overlay"),Te=!1);break;case"shutdown":console.warn("[preload] 🔻 Shutdown command received"),w&&w.connected&&(w.emit("status",{message:"Shutting down..."}),w.disconnect()),Dt.exec("shutdown /s /t 0");break;case"reboot":case"restart":console.warn("[preload] 🔁 Restart command received"),w&&w.connected&&(w.emit("status",{message:"Restarting..."}),w.disconnect()),Dt.exec("shutdown /r /t 0");break;case"mirror-start":fe||(console.log("[mirror] start triggered by command"),Ls());break;case"mirror-stop":fe&&(console.log("[mirror] stop triggered by command"),As());break;default:console.log("Unknown command:",s)}}function dt(s){Te&&(s.stopPropagation(),s.preventDefault())}window.addEventListener("keydown",dt,!0);window.addEventListener("mousedown",dt,!0);window.addEventListener("mousemove",dt,!0);window.addEventListener("contextmenu",dt,!0);let Ns=Date.now();setInterval(()=>{fe&&Date.now()-Ns>5e3&&(console.warn("[mirror] No ACK for 5s, restarting mirror..."),As(),Ls())},3e3);let _e=!1;async function Ls(){if(_e)return;_e=!0,console.log("[mirror] Started");let s=1e3/mo,e=0;const t=async()=>{if(_e){try{if(!w||!w.connected)return;const r=await j.ipcRenderer.invoke("capture-screen");if(!r)return;e=r.length/1024,w.emit("mirror-frame",r),e>800?s=400:e>400?s=200:s=100}catch(r){console.error("[mirror] Error:",r)}_e&&(fe=window.setTimeout(t,s))}};t()}function As(){_e&&(console.log("[mirror] Stopping mirror..."),_e=!1,fe&&(clearTimeout(fe),fe=null),console.log("[mirror] Stopped"))}window.addEventListener("message",s=>{const e=s.data;(e==null?void 0:e.action)==="annotation-path"&&w&&w.connected&&w.emit("annotationUpdate",e.payload)});function Co(){if(!w)return;w.on("annotationDraw",e=>{console.log("[preload] annotationDraw received:",e),window.postMessage({action:"annotation-draw",payload:e})})}j.contextBridge.exposeInMainWorld("electronAPI",{getPCInfo:()=>({hostname:M.hostname(),os:M.platform()}),connectToControlServer:go,disconnectFromControlServer:_o,send:(s,e)=>j.ipcRenderer.send(s,e),invoke:(s,e)=>j.ipcRenderer.invoke(s,e)});j.contextBridge.exposeInMainWorld("screenAPI",{isElectron:!0,async getScreenSources(){try{const s=await j.ipcRenderer.invoke("get-screen-sources");return console.log("[screenAPI] got sources:",s.length),s}catch(s){return console.error("[screenAPI] getScreenSources failed:",s),[]}},async createScreenStream(s){return console.log("[screenAPI] returning sourceId only (renderer will create stream)"),s}});j.contextBridge.exposeInMainWorld("ipc",{on:(...s)=>j.ipcRenderer.on(...s),off:(...s)=>j.ipcRenderer.off(...s),send:(...s)=>j.ipcRenderer.send(...s),invoke:(...s)=>j.ipcRenderer.invoke(...s)});globalThis.__PRELOAD_OK__=!0;console.log("[preload] electronAPI & screenAPI exposed successfully");
